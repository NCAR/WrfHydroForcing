name: Run pytest

on:
  push:
    branches:
      - refactor  # Adjust the branch name as per your repository's default branch

jobs:
  pytest:
    runs-on: ubuntu-latest   # Use the desired operating system for the CI environment

    steps:
      - name: Checkout code
        uses: actions/checkout@v2

      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.11  # Specify the desired Python version

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt  # If you have a requirements.txt file
          export PYTHONPATH=$PYTHONPATH:/home/runner/work/WrfHydroForcing/WrfHydroForcing
          export PYTHONPATH=$PYTHONPATH:/home/runner/work/WrfHydroForcing/WrfHydroForcing/core

      - name: Run pytest
        run: pytest

      # Optional: Generate test coverage report
      - name: Install coverage tool
        run: pip install coverage

      - name: Run pytest with coverage
        run: coverage run -m pytest

      - name: Generate coverage report
        run: coverage html -i
